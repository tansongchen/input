<script setup>
import Practice from '../components/Practice.vue'
import PUAViewer from '../components/PUAViewer.vue'
import roots from './roots.yaml'
import analysis_tygf from './analysis-tygf.yaml'
import analysis_extra from './analysis-extra.yaml'

const 声韵 = Object.entries({
  // 声母
  zh: 'z',
  ch: 'c',
  sh: 's',
  '零声母': 'v',
  // 韵母
  'i er': 'i',
  'u ü': 'u',
  'a ia ua': 'a',
  'e ie üe': 'e',
  'o io uo': 'o',
  'ai uai': 'i',
  'ei uei': 'e',
  'ao iao': 'o',
  'ou iou': 'a',
  'an ian uan üan': ';',
  'ang iang uang': ',',
  'en in uen ün n m': '.',
  'eng ing ueng ong iong ng': '/'
}).map(([front, back]) => ({ front, back }));

const 主根 = roots.filter(x => !("读音" in x)).map(x => ({ front: x.字根, back: x.编码 }));
const 副根 = roots.filter(x => "读音" in x).map(x => ({
  front: x.字根,
  back: x.编码, 
  hint: x.读音.replace("（", "(").replace("）", ")")
}));

const 字根映射 = new Map();
const PUA = [];
for (const { 字根, 编码 } of roots) {
    for (const 字符 of [...字根]) {
        if (字符.codePointAt(0) >= 0xe000 && 字符.codePointAt(0) <= 0xf9ff) {
          PUA.push(字符);
        }
        字根映射.set(字符, 编码);
    }
}

PUA.sort();

function convert(analysis) {
  const result = [];
  for (const { 部件, 拆分 } of analysis) {
      const key = `${部件} → ${拆分}`;
      const 拆分列表 = [...拆分];
      const value = [];
      if (拆分列表.length >= 4) {
        [拆分列表[0], 拆分列表[1], 拆分列表[2], 拆分列表.at(-1)].forEach(x => value.push(字根映射.get(x)[0]));
      } else {
        拆分列表.forEach(x => value.push(字根映射.get(x)[0]));
        value.push(字根映射.get(拆分列表.at(-1))[1]);
      }
      result.push({ front: key, back: value.join("") });
  }
  return result;
}

const 通用规范拆分列表 = convert(analysis_tygf);
const 其他拆分列表 = convert(analysis_extra);
</script>

<style scoped>
.strokes table td:nth-child(1),
.strokes table th:nth-child(1),
.strokes table td:nth-child(2),
.strokes table th:nth-child(2) {
  min-width: 48px;
}

span.hold {
  white-space: nowrap;   /* 禁止文字换行 */
  display: inline-block; /* 可选，方便控制宽度、padding 等 */
}
</style>

# 拼写规则

本方案中，「拼写」一词有双重含义：将不带调的汉语拼音音节分解为声母和韵母，它们一方面直接用于输入词语的各个音节，另一方面用于定义一系列字根的编码，这些字根可以用于输入单字。例如：

- 「八 ba」可以分解为声母 b 和韵母 a，因此它作为词语的音码编码就是 `ba`；
- 「八 ba」同时也是一个字根，这个字根的形码编码也是 `ba`。

下面我们首先介绍声母和韵母编码，然后据此导出字根的编码。

## 声母和韵母

声母的编码与汉语拼音中基本相同，区别仅仅在于 zh, ch, sh 这三个声母分别合并到了声码 `z`, `c`, `s`（即不分平翘舌）。另外，对于以字母 a, o, e 开始的零声母音节，使用 `v` 表示零声母。

韵母首先按照[《中华通韵》](https://sou-yun.cn/mqr.aspx)中的韵部归并为 15 组，然后安排在 `aeiou;,./` 九个键上。其对应关系如下表：

| 韵部          | 韵母                    | 编码 |
| ------------- | ----------------------- | ---- |
| 一啊/十欧     | a, ia, ua, ou, iou (iu) | `a`  |
| 二喔/九熬     | o, uo, ao, iao          | `o`  |
| 三鹅/八欸     | e, ie, üe, ei, uei (ui) | `e`  |
| 四衣/七哀     | i, er, ai, uai          | `i`  |
| 五乌/六迂     | u, ü                    | `u`  |
| 十一安        | an, ian, uan, üan       | `;`  |
| 十二恩        | en, in, uen (un), ün    | `.`  |
| 十三昂        | ang, iang, uang         | `,`  |
| 十四英/十五雍 | eng, ing, ong, iong     | `/`  |

请您在下面的小游戏中练习声母和韵母的拼写：

<Practice :data="声韵" name="冰雪清韵-声韵" />

## 字根

下面我们将利用声母、韵母来定义每个字根的两个编码，即声码和韵码。对于绝大多数字根（85%）来说，声码和韵码就是字根声母和韵母对应的编码，而非成字字根则会归并到形似的成字字根上，这些字根称为「副根」；但为了提升形码编码的离散能力和手感，存在一些高频字根，它的声码和韵码是无理的，这些字根称为「主根」。主根又分为「第一主根」和「第二主根」，其区别在于韵码不同。

| 类别     | 组数 | 个数 | 声码 | 韵码          |
| -------- | ---- | ---- | ---- | ------------- |
| 第一主根 | 6    | 6    | 无理 | 左 `i` 右 `e` |
| 第二主根 | 21   | 47   | 无理 | 左 `o` 右 `a` |
| 副根     | 147  | 288  | 声母 | 韵母          |

您可以点击[此处](/冰雪清韵・字根表.pdf)下载字根表的 PDF 文件，以备查阅。

## 第一主根

第一主根有 6 组，均为单笔画字根，组名用全角数字「１、２、３、４、５、６」表示。它们的声码为无理，声码在左手时韵码为 `i`、声码在右手时韵码为 `e`。

<div class="strokes">

| 组名 | 编码 | 包含的笔画种类                                                                                                                             |
| ---- | ---- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| １   | `ke` | 横、提                                                                                                                                     |
| ２   | `me` | 竖、竖钩                                                                                                                                   |
| ３   | `he` | 撇                                                                                                                                         |
| ４   | `gi` | 点、捺、挑捺                                                                                                                               |
| ５   | `le` | 横钩、横撇、横折、横折钩、横斜钩、横折提、横折折、横折弯、横撇弯钩、横折弯钩、横斜弯钩、横折折撇、横折折折、横折折折钩、竖弯左、弯钩、撇钩 |
| ６   | `je` | 竖提、竖折、竖弯、竖弯钩、竖折撇、竖折折钩、竖折折、撇点、撇折、斜钩、卧钩、圈、特殊笔画                                                   |

</div>

注意，「５」和「６」的区别在于「５」第一次转折的方向为顺时针，「６」第一次转折的方向为逆时针；由于手写画圈时一般是逆时针，所以圈和其他特殊笔画也归类为「６」。

## 第二主根

第二主根有 21 组，其声码分别规定为 `bpmfdtnlgkhjqxzcsrwyv`，声码在左手时韵码为 `o`、声码在右手时韵码为 `a`。这些字根的声码并不是字根声母的键位，需要特别记忆，不过这是为了提高形码性能的必要牺牲。

请您在下面的小游戏中练习第一主根和第二主根的拼写：

<Practice :data="主根" name="冰雪清韵-主根" songti />

## 副根

副根有 150 组，声码和韵码就是字根读音声母和韵母对应的编码。字根读音安排的规律如下：

1. 属于《通用规范汉字表》的字根，取该表规定的读音之一（如「七 `qi`」「八 `ba`」）；
2. 不属于《通用规范汉字表》，但属于 GF0014-2009《现代常用字部件及部件名称规范》的字根，要么取 GF0014-2009 规定的读音（如「宀 `bo`」，取自「宝（bǎo）盖」），要么归并到形似的其他字根（如「罒」归并到「目 `mu`」）；
3. 不属于《通用规范汉字表》，也不属于 GF0014-2009 的，归并到形似的其他字根（如「丅」归并到「下 `xa`」）；

请您在下面的小游戏中练习副根的拼写，练习时会提示其读音：

<Practice :data="副根" name="冰雪清韵-副根" songti />

## 字根在不同字集中的使用情况

本方案为简繁通打方案，简化字和对应的传承字一般来说不会重码。但与其他简繁通打方案不同的是，本方案中极少出现在只打简化字时用不到的字根，并且这些极少数的字根均为上面的第 3 类，即按形似归并到其他字根。这样一来，当用户希望输入更大的字集时，他所需要掌握的字根组数不变，而字根个数仅仅增加几个或十几个。

例如，「见 `j;`」是字根，而「見」则拆分为「目 `mu`」和「儿 `vi`」；「马 `ma`」是字根，而「馬」则拆分为「馬无灬 `ma`」和「灬 `qo`」，其中「馬无灬」是按形似归并到「马」的。

| 字集                                     | <span class="hold">字数</span> | <span class="hold">字根</span>组数 | <span class="hold">字根</span>个数 | <span class="hold">比上一级</span>增加个数 |
| ---------------------------------------- | ------------------------------ | ---------------------------------- | ---------------------------------- | ------------------------------------------ |
| 通用规范汉字表                           | 8105                           | 174                                | 322                                |                                            |
| 通用规范汉字表和常用国字标准字体表的并集 | 9968                           | 174                                | 336                                | 14                                         |
| CJK 基本集                               | 21265                          | 174                                | 341                                | 5                                          |

## 字根认同

字根认同，是指判断某个字是否含有某个字根的标准。在冰雪清韵中，将某个字中的若干个笔画认同为一个字根的标准为：

1. 这些笔画的种类按笔顺依次相同（允许横-提互变、捺-点互变）：例如，「办」中最左边的笔画为点而不是撇，因此左边和右边的两笔认同为「横两点 `vi`」，而不是「八 `va`」；
2. 这些笔画的相连和相交关系依次相同：例如，「而」的前两笔，认同为「丆 `di`」，而不是「厂 `c,`」或「左字框 `q;`」；
3. 这些笔画在字中的笔顺是连续的：例如，「再」中的「王」笔顺不连续，因此拆分为「一 `ke`、冂 `ne`、里无日 `tu`」。

## 拆分方式筛选

拆分方式筛选，是指在多种可行的拆分方式中唯一确定最优拆分方式的标准。在冰雪清韵中，需要注意的原则依次是：结构完整、字根最少、能连不交、能散不连、向前取大。关于这些规则的具体解释，可以参考[宇浩系列输入法的拆分教程](https://shurufa.app/learn/division.html)。

一般来说，汉字可以先分为一些视觉上连接紧密的成分（这些成分称为部件），然后再将部件拆分为字根。前者比较简单，而后者则比较难，因此对于拆分的学习也就主要是部件拆分的学习。在 CJK 基本集内共有 784 个部件，其中一部分已经选为字根，只需要理解并掌握剩下 530 个部件的拆分就不会遇到任何难拆的字。特别地，如果只要求输入《通用规范汉字表》中的汉字，则只需要理解并掌握其中 405 个部件的拆分，而其余 125 个则属于大字集的拆分。在用户输入以简体文本为主的情况下，可以先练习下面的第一部分，等有需要时再练习第二部分。

请您在下面的小游戏中练习部件的拆分，练习时请输入第一、二、三、末字根的声码，如小于四字根则补末字根的韵码：

### 通用规范汉字部件拆分

<Practice :data="通用规范拆分列表" name="冰雪清韵-通用规范拆分" songti />

### 其他部件拆分

<Practice :data="其他拆分列表" name="冰雪清韵-其他拆分" songti />

您也可以点击[此处](/冰雪清韵・部件拆分表.pdf)下载部件拆分的 PDF 文件，以备查阅。

## 开始冰雪清韵的旅程！

在学习完声母和韵母的拼写、以及基于它们定义的字根的声码和韵码之后，我们建议您立即开始使用冰雪清韵在「全息」模式下打字，在这个模式下，您可以打好基础，最快地熟悉拼写规则。全息模式的编码规则为：

- 词语：依次输入每个音节的编码，其中每个音节可以完整输入声母和韵母，也可以只输入声母；
- 单字：依次输入每个字根的编码，其中每个字根可以完整输入声码和韵码，也可以只输入声码；

请在您的用户文件夹新建 `snow_qingyun.custom.yaml`，并在其中写入以下内容：

```yaml
patch:
  # 开启全息模式
  switches/@4/reset: 0
```

重新部署后，您就可以用上面的拼写规则来输入任意长度的词语，或包含任意数量字根的单字：

![rime](https://images.tansongchen.com/1759465478.png)

![rime](https://images.tansongchen.com/1759465439.png)

## 单字模式

在有候选且候选在第一页的时候，按下 Shift+Tab 进入单字模式，候选只有单字，方便输入生僻字（如果不在第一页，Shift+Tab 是向前翻页）。

## 附录：边缘音节的处理

有少量处于汉语拼音语音体系边缘位置的音节未包含在本节开头关于声母和韵母的说明中。其输入方式如下：

- 纯鼻音韵母构成的音节如「嗯 ng」「呒 m」「哼 hng」「噷 hm」等，分析为零声母（以及声母 h）加上鼻音韵母 ng 和 m，其中 ng 归并到 eng，m 归并到 en。这几个字最终编码分别为 `v/`, `v.`, `h/`, `h.`；
- 只以零声母形式出现的韵母 io（即「哟 `yo`」）和韵母 ueng（即「翁 `weng`」），分别归并到 o 和 eng。这几个字最终编码分别为 `yo` 和 `w/`。
